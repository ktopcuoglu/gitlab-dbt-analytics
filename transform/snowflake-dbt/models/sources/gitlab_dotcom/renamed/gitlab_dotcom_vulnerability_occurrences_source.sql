WITH source AS (

    SELECT *
    FROM {{ ref('gitlab_dotcom_vulnerability_occurrences_dedupe_source') }}
    
)
SELECT 
    created_at::TIMESTAMP                                                   AS vulnerability_created_at,
    name::VARCHAR                                                           AS vulnerability_name,
    report_type::NUMBER                                                     AS vulnerability_report_type,
    severity::NUMBER                                                        AS vulnerability_severity,
    SHA2(RANDSTR(32, project_id::NUMBER) || project_id::VARCHAR)::VARCHAR   AS project_id,
    id::NUMBER                                                              AS vulnerability_occurrences_id,                                       
    updated_at::TIMESTAMP                                                   AS vulnerability_updated_at,
    confidence::NUMBER                                                      AS vulnerability_confidence,
    report_type::NUMBER                                                     AS vulnerability_report_type,
    project_id::NUMBER                                                      AS vulnerability_project_id,
    scanner_id::NUMBER                                                      AS vulnerability_scanner_id,
    primary_identifier_id::NUMBER                                           AS vulnerability_primary_identifier_id,
    uuid::TEXT                                                              AS vulnerability_uuid,
    name::TEXT                                                              AS vulnerability_name,
    metadata_version::TEXT                                                  AS vulnerability_metadata_version,
    raw_metadata::TEXT                                                      AS vulnerability_raw_metadata,
    vulnerability_id::FLOAT                                                 AS vulnerability_id
FROM source

